{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "ThingWorx Build Spec",
  "type": "object",
  "additionalProperties": false,
  "required": ["apiVersion", "things"],
  "properties": {
    "apiVersion": { "type": "string", "enum": ["1.0"] },
    "metadata": {
      "type": "object",
      "additionalProperties": true,
      "properties": { "name": { "type": "string" }, "description": { "type": "string" } }
    },
    "things": { "type": "array", "minItems": 1, "items": { "$ref": "#/$defs/ThingSpec" } },
    "mashups": { "type": "array", "items": { "$ref": "#/$defs/MashupSpec" }, "default": [] },
    "steps": { "type": "array", "items": { "$ref": "#/$defs/StepSpec" }, "default": [] }
  },
  "$defs": {
    "ThingSpec": {
      "type": "object",
      "additionalProperties": false,
      "required": ["name"],
      "properties": {
        "name": { "type": "string", "minLength": 1 },
        "template": { "type": "string", "default": "GenericThing" },
        "description": { "type": "string" },
        "enable": { "type": "boolean", "default": true },
        "properties": { "type": "array", "items": { "$ref": "#/$defs/PropertySpec" }, "default": [] },
        "services": { "type": "array", "items": { "$ref": "#/$defs/ServiceSpec" }, "default": [] }
      }
    },
    "PropertySpec": {
      "type": "object",
      "additionalProperties": false,
      "required": ["name", "baseType"],
      "properties": {
        "name": { "type": "string" },
        "baseType": { "type": "string" },
        "description": { "type": "string" },
        "persistent": { "type": "boolean", "default": false },
        "readOnly": { "type": "boolean", "default": false },
        "logged": { "type": "boolean", "default": false }
      }
    },
    "ServiceSpec": {
      "type": "object",
      "additionalProperties": false,
      "required": ["name", "code"],
      "properties": {
        "name": { "type": "string" },
        "description": { "type": "string" },
        "inputs": { "type": "array", "items": { "$ref": "#/$defs/ParameterSpec" }, "default": [] },
        "outputs": {
          "type": "object",
          "additionalProperties": false,
          "properties": { "baseType": { "type": "string" }, "description": { "type": "string" } },
          "default": { "baseType": "NOTHING" }
        },
        "code": { "type": "string" },
        "kind": { "type": "string", "enum": ["JavaScript"], "default": "JavaScript" }
      }
    },
    "ParameterSpec": {
      "type": "object",
      "additionalProperties": false,
      "required": ["name", "baseType"],
      "properties": {
        "name": { "type": "string" },
        "baseType": { "type": "string" },
        "description": { "type": "string" },
        "required": { "type": "boolean", "default": false }
      }
    },
    "MashupSpec": {
      "type": "object",
      "additionalProperties": false,
      "required": ["name", "mashupContent"],
      "properties": {
        "name": { "type": "string", "minLength": 1 },
        "description": { "type": "string" },
        "mashupContent": { "type": "string" }
      }
    },
    "StepSpec": {
      "type": "object",
      "additionalProperties": false,
      "required": ["action"],
      "properties": {
        "action": { "type": "string", "enum": ["createOrUpdateThing","enableThing","addProperties","addServices","createOrUpdateMashups"] },
        "target": { "type": "string" }
      }
    }
  }
}
